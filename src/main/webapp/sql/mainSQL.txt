-- 데이터베이스 설정

-- (1) : 최초 1회 실행,  buskingdb 생성 명령어
CREATE DATABASE buskingdb
CHARACTER SET utf8mb4 -- 문자 하나를 최대 4바이트까지 저장 가능하도록 설정
COLLATE utf8mb4_unicode_ci; -- unicode 표준 기준으로 비교 설정 및 대소문자 구분 하지 않는 설정

-- 데이터베이스들 조회 명령어
SHOW DATABASES;

-- (2) 디비 사용 및 선택 명령어
USE buskingdb;

-- (3) : 최초 1회 실행, 디비에서 사용할 계정 생성
CREATE USER 'busker'@'localhost'
IDENTIFIED BY '1234';

-- (4) : 최초 1회 실행, 생성한 계정에 권한 부여
GRANT ALL PRIVILEGES ON buskingdb.* TO 'busker'@'localhost';

-- (5) : 최초 1회 실행, 권한 갱신
FLUSH PRIVILEGES;


CREATE TABLE member (
    id BIGINT NOT NULL AUTO_INCREMENT COMMENT 'PK',

    member_id VARCHAR(20) NOT NULL COMMENT '로그인 ID',
    pw VARCHAR(100) NOT NULL COMMENT '비밀번호',
    name VARCHAR(50) NOT NULL COMMENT '이름',
    nickname VARCHAR(50) COMMENT '닉네임',
    email VARCHAR(225) COMMENT '이메일',
    phone VARCHAR(11) COMMENT '전화번호',
    birth_date DATE COMMENT '생년월일',
    gender CHAR(1) COMMENT '성별(M/F)',
    created_member_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '생성일',

    PRIMARY KEY (id),
    UNIQUE KEY uk_member_member_id (member_id)
);
-- 중복을 허용하지 않는 컬럼이 member_id, nickname?, 


------------------------------------------------------


CREATE TABLE gear (
    id BIGINT NOT NULL AUTO_INCREMENT COMMENT '장비 PK',

    gear_name VARCHAR(100) NOT NULL COMMENT '장비명',
    gear_description TEXT COMMENT '설명',
    gear_price INT NOT NULL COMMENT '가격',
    gear_thumbnail VARCHAR(255) COMMENT '썸네일',
    gear_quantity INT NOT NULL COMMENT '개수',

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '생성일',
    
    PRIMARY KEY (id)
);



INSERT INTO gear (
    gear_name,
    gear_description,
    gear_price,
    gear_thumbnail,
    gear_quantity
) VALUES
('어쿠스틱 기타', '버스킹용 기본 어쿠스틱 기타', 15000, 'acoustic_guitar.jpg', 10),
('일렉 기타 앰프', '야외 공연용 고출력 기타 앰프', 20000, 'guitar_amp.jpg', 10),
('마이크 세트', '유선 마이크 + 스탠드 포함', 10000, 'mic_set.jpg', 10),
('포터블 스피커', '야외용 블루투스 스피커', 25000, 'portable_speaker.jpg', 10),
('전자 키보드', '61건반 전자 키보드', 30000, 'keyboard.jpg', 10),
('카혼', '버스킹용 타악기 카혼', 12000, 'cajon.jpg', 10),
('마이크 스탠드', '높이 조절 가능 스탠드', 5000, 'mic_stand.jpg', 10),
('이펙터 보드', '기타 멀티 이펙터', 18000, 'effector.jpg', 10);



CREATE TABLE gear_reservation (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT '예약 PK',

    gear_id BIGINT NOT NULL COMMENT '장비 ID',
    member_id BIGINT NOT NULL COMMENT '회원 PK (member.id)',

    start_datetime DATETIME NOT NULL COMMENT '대여 시작',
    end_datetime DATETIME NOT NULL COMMENT '대여 종료',

    status VARCHAR(20) DEFAULT 'RESERVED' COMMENT '상태',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '생성일',

    CONSTRAINT fk_gear_reservation_gear
        FOREIGN KEY (gear_id)
        REFERENCES gear(id)
        ON DELETE CASCADE,

    CONSTRAINT fk_gear_reservation_member
        FOREIGN KEY (member_id)
        REFERENCES member(id)
        ON DELETE CASCADE
);