-- CITY
CREATE TABLE city (
  city_id   BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  city_code VARCHAR(30) NOT NULL UNIQUE COMMENT 'seoul, busan ...',
  city_name VARCHAR(50) NOT NULL COMMENT '서울특별시, 부산광역시 ...'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO city (city_code, city_name) VALUES
('seoul',   '서울특별시'),
('incheon', '인천광역시'),
('busan',   '부산광역시'),
('daegu',   '대구광역시'),
('gwangju', '광주광역시'),
('ulsan',   '울산광역시'),
('daejeon', '대전광역시');

-- PLACE
CREATE TABLE place (
  place_id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
  city_id  BIGINT NOT NULL,
  place_name VARCHAR(100) NOT NULL,
  place_address VARCHAR(255) NOT NULL,
  place_phone VARCHAR(50) NULL COMMENT 'JSP에서 사용',
  place_description TEXT NULL,
  place_status TINYINT(1) NOT NULL DEFAULT 1,
  thumbnail VARCHAR(255) NULL COMMENT '이미지 경로(/images/..)',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT fk_place_city FOREIGN KEY (city_id) REFERENCES city(city_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- RESERVATION
CREATE TABLE place_reservation (
  id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,

  user_id BIGINT NOT NULL,
  place_id BIGINT NOT NULL,

  band_name VARCHAR(100) NOT NULL,
  band_count INT NOT NULL,

  phone VARCHAR(50) NULL,
  email VARCHAR(100) NULL,

  reservation_date DATE NOT NULL,
  start_time TIME NOT NULL,
  end_time TIME NULL,

  status TINYINT(1) NOT NULL DEFAULT 1 COMMENT '1=완료,0=취소',
  created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

  CONSTRAINT uq_place_reservation_slot
      UNIQUE (place_id, reservation_date, start_time),

  CONSTRAINT fk_res_place
      FOREIGN KEY (place_id) REFERENCES place(place_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- (선택) 같은 장소/날짜/시간 중복 방지
CREATE UNIQUE INDEX uq_reservation_slot
ON reservation(place_id, reservation_date, start_time);
