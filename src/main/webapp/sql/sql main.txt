CREATE DATABASE IF NOT EXISTS buskingdb
CHARACTER SET utf8mb4
COLLATE utf8mb4_unicode_ci;

USE buskingdb;

delete from member where id = 1;

delete from place_reservation where user_id = 4;

select * from member;
select * from board;

select * from place;

select * from place_reservation;
select * from gear_reservation;
select * from gear;
delete from gear;


TRUNCATE gear;
TRUNCATE gear_reservation;

TRUNCATE TABLE gear_reservation;
TRUNCATE TABLE gear;
DELETE FROM gear WHERE id > 0;

drop table place_reservation;
drop table place;


desc board;

CREATE USER IF NOT EXISTS 'busker'@'localhost'
IDENTIFIED BY '1234';

GRANT ALL PRIVILEGES ON buskingdb.* TO 'busker'@'localhost';
FLUSH PRIVILEGES;

CREATE TABLE member (
    id BIGINT NOT NULL AUTO_INCREMENT COMMENT 'PK',

    member_id VARCHAR(20) NOT NULL COMMENT 'ë¡œê·¸ì¸ ID',
    pw VARCHAR(100) NOT NULL COMMENT 'ë¹„ë°€ë²ˆí˜¸',
    name VARCHAR(50) NOT NULL COMMENT 'ì´ë¦„',
    nickname VARCHAR(50) COMMENT 'ë‹‰ë„¤ì„',
    email VARCHAR(225) COMMENT 'ì´ë©”ì¼',
    phone VARCHAR(11) COMMENT 'ì „í™”ë²ˆí˜¸',
    birth_date DATE COMMENT 'ìƒë…„ì›”ì¼',
    gender CHAR(1) COMMENT 'ì„±ë³„(M/F)',
    created_member_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ìƒì„±ì¼',

    PRIMARY KEY (id),
    UNIQUE KEY uk_member_member_id (member_id)
);

CREATE TABLE gear (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ì¥ë¹„ PK',

    
    gear_name VARCHAR(100) NOT NULL COMMENT 'ì¥ë¹„ëª…',
    gear_description TEXT COMMENT 'ì„¤ëª…',
    gear_price INT NOT NULL COMMENT 'ê°€ê²©',
    gear_thumbnail VARCHAR(255) COMMENT 'ì¸ë„¤ì¼',
   gear_quantity INT NOT NULL COMMENT 'ê°œìˆ˜',

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ìƒì„±ì¼'
) ENGINE=InnoDB;
INSERT INTO gear (
    gear_quantity,
    gear_name,
    gear_description,
    gear_price,
    gear_thumbnail
) VALUES
(3, 'ì–´ì¿ ìŠ¤í‹± ê¸°íƒ€', 'ë²„ìŠ¤í‚¹ìš© ê¸°ë³¸ ì–´ì¿ ìŠ¤í‹± ê¸°íƒ€', 15000, 'guitar.jpg'),
(8, 'ì¼ë ‰ ê¸°íƒ€ ì•°í”„', 'ì•¼ì™¸ ê³µì—°ìš© ê³ ì¶œë ¥ ê¸°íƒ€ ì•°í”„', 20000, 'em.jpg'),
(2, 'ë§ˆì´í¬ ì„¸íŠ¸', 'ìœ ì„  ë§ˆì´í¬ + ìŠ¤íƒ ë“œ í¬í•¨', 10000, 'ma.jpg'),
(5, 'í¬í„°ë¸” ìŠ¤í”¼ì»¤', 'ì•¼ì™¸ìš© ë¸”ë£¨íˆ¬ìŠ¤ ìŠ¤í”¼ì»¤', 25000, 'speak.jpg'),
(4, 'ì „ì í‚¤ë³´ë“œ', '61ê±´ë°˜ ì „ì í‚¤ë³´ë“œ', 30000, 'key.jpg'),
(10, 'ì¹´í˜¼', 'ë²„ìŠ¤í‚¹ìš© íƒ€ì•…ê¸° ì¹´í˜¼', 12000, 'kahon.jpg'),
(3, 'ë§ˆì´í¬ ìŠ¤íƒ ë“œ', 'ë†’ì´ ì¡°ì ˆ ê°€ëŠ¥ ìŠ¤íƒ ë“œ', 5000, 'stand.jpg'),
(4, 'ì´í™í„° ë³´ë“œ', 'ê¸°íƒ€ ë©€í‹° ì´í™í„°', 18000, 'ter.jpg');
SELECT gear_id, place_id, gear_name, gear_price FROM gear;


CREATE TABLE gear_reservation (
    id BIGINT AUTO_INCREMENT PRIMARY KEY COMMENT 'ì˜ˆì•½ PK',

    gear_id BIGINT NOT NULL COMMENT 'ì¥ë¹„ ID (gear.id)',
    member_id BIGINT NOT NULL COMMENT 'íšŒì› PK (member.id)',

    start_datetime DATETIME NOT NULL COMMENT 'ëŒ€ì—¬ ì‹œì‘',
    end_datetime DATETIME NOT NULL COMMENT 'ëŒ€ì—¬ ì¢…ë£Œ',

    status VARCHAR(20) DEFAULT 'RESERVED' COMMENT 'ìƒíƒœ',
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ìƒì„±ì¼',

    CONSTRAINT fk_gear_reservation_gear
        FOREIGN KEY (gear_id)
        REFERENCES gear(id)
        ON DELETE CASCADE,

    CONSTRAINT fk_gear_reservation_member
        FOREIGN KEY (member_id)
        REFERENCES member(id)
        ON DELETE CASCADE
) ENGINE=InnoDB;


   CREATE TABLE city (
     city_id   BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
     city_code VARCHAR(30) NOT NULL UNIQUE COMMENT 'seoul, busan ...',
     city_name VARCHAR(50) NOT NULL COMMENT 'ì„œìš¸íŠ¹ë³„ì‹œ, ë¶€ì‚°ê´‘ì—­ì‹œ ...'
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

   INSERT INTO city (city_code, city_name) VALUES
   ('seoul',   'ì„œìš¸íŠ¹ë³„ì‹œ'),
   ('incheon', 'ì¸ì²œê´‘ì—­ì‹œ'),
   ('busan',   'ë¶€ì‚°ê´‘ì—­ì‹œ'),
   ('daegu',   'ëŒ€êµ¬ê´‘ì—­ì‹œ'),
   ('gwangju', 'ê´‘ì£¼ê´‘ì—­ì‹œ'),
   ('ulsan',   'ìš¸ì‚°ê´‘ì—­ì‹œ'),
   ('daejeon', 'ëŒ€ì „ê´‘ì—­ì‹œ');

   -- PLACE
   CREATE TABLE place (
     place_id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
     city_id  BIGINT NOT NULL,
     place_name VARCHAR(100) NOT NULL,
     place_address VARCHAR(255) NOT NULL,
     place_phone VARCHAR(50) NULL COMMENT 'JSPì—ì„œ ì‚¬ìš©',
     place_description TEXT NULL,
     thumbnail VARCHAR(255) NULL COMMENT 'ì´ë¯¸ì§€ ê²½ë¡œ(/images/..)',
     created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
     CONSTRAINT fk_place_city FOREIGN KEY (city_id) REFERENCES city(city_id)
   ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
    
use buskingdb;
TRUNCATE place;
delete from place;
delete from place_reservation;

select * from place_reservation;

select * from place;

delete from place
where city_id > 0;

DELETE FROM place_reservation
WHERE id > 0;

    
    insert into place
(city_id, place_name, place_address, place_phone, place_description, thumbnail)
values

-- ì„œìš¸
(1, 'ì„œìš¸ê´‘ì¥', 'ì„œìš¸ ì¤‘êµ¬ ì„¸ì¢…ëŒ€ë¡œ', '02-120', 'ì„œìš¸ ëŒ€í‘œ ë²„ìŠ¤í‚¹ ê´‘ì¥', 'seoul.jpg'),
(1, 'í•œê°•ê³µì› ì—¬ì˜ë„', 'ì„œìš¸ ì˜ë“±í¬êµ¬ ì—¬ì˜ë™ë¡œ', '02-3780-0561', 'í•œê°• ë²„ìŠ¤í‚¹ ì¸ê¸° ì§€ì—­', 'Han River.png'),
(1, 'í™ëŒ€ ê±·ê³ ì‹¶ì€ê±°ë¦¬', 'ì„œìš¸ ë§ˆí¬êµ¬ í™ìµë¡œ', '02-3153-8100', 'ì ŠìŒì˜ ê±°ë¦¬ ë²„ìŠ¤í‚¹ ëª…ì†Œ', 'Hongdae.png'),

-- ì¸ì²œ
(2, 'ì†¡ë„ ì„¼íŠ¸ëŸ´íŒŒí¬', 'ì¸ì²œ ì—°ìˆ˜êµ¬ ì»¨ë²¤ì‹œì•„ëŒ€ë¡œ', '032-721-4415', 'ì•¼ì™¸ ê³µì—° ê°€ëŠ¥ êµ¬ì—­',  'songdo.jpg'),
(2, 'ì°¨ì´ë‚˜íƒ€ìš´ ê´‘ì¥', 'ì¸ì²œ ì¤‘êµ¬ ì°¨ì´ë‚˜íƒ€ìš´ë¡œ', '032-777-1330', 'ê´€ê´‘ê° ë°€ì§‘ ì§€ì—­',  'chinatown.jpeg'),
(2, 'ì›”ë¯¸ë„ ë¬¸í™”ê±°ë¦¬', 'ì¸ì²œ ì¤‘êµ¬ ì›”ë¯¸ë¡œ', '032-765-4169', 'ì£¼ë§ ê³µì—° í™œë°œ',  'mido.jpg'),

-- ë¶€ì‚°
(3, 'í•´ìš´ëŒ€ í•´ë³€ë¬´ëŒ€', 'ë¶€ì‚° í•´ìš´ëŒ€êµ¬', '051-749-4000', 'í•´ìš´ëŒ€ ë²„ìŠ¤í‚¹ êµ¬ì—­',  'haeundae.jpg'),
(3, 'ê´‘ì•ˆë¦¬ í•´ë³€ê³µì—°ì¥', 'ë¶€ì‚° ìˆ˜ì˜êµ¬', '051-610-4882', 'ì•¼ê²½ ë²„ìŠ¤í‚¹ ëª…ì†Œ',  'Gwanganri.png'),
(3, 'ì„œë©´ ë¬¸í™”ê±°ë¦¬', 'ë¶€ì‚° ë¶€ì‚°ì§„êµ¬', '051-605-4522', 'ìœ ë™ì¸êµ¬ ë§ìŒ',  'seomyeon.jpg'),

-- ëŒ€êµ¬
(4, 'ë™ì„±ë¡œ ì¤‘ì•™ë¬´ëŒ€', 'ëŒ€êµ¬ ì¤‘êµ¬ ë™ì„±ë¡œ', '053-803-0114', 'ë„ì‹¬ ë²„ìŠ¤í‚¹ êµ¬ì—­',  'dongsungro.jpg'),
(4, 'ìˆ˜ì„±ëª» ê³µì—°ì¡´', 'ëŒ€êµ¬ ìˆ˜ì„±êµ¬', '053-666-2863', 'ì•¼ì™¸ ê³µì—° ì¥ì†Œ',  'suseong.jpg'),
(4, 'ê¹€ê´‘ì„ ê±°ë¦¬', 'ëŒ€êµ¬ ì¤‘êµ¬', '053-661-2620', 'ìŒì•… í…Œë§ˆ ê±°ë¦¬',  'kim.jpg'),

-- ê´‘ì£¼
(5, 'ê¸ˆë‚¨ë¡œ ë¬¸í™”ê´‘ì¥', 'ê´‘ì£¼ ë™êµ¬', '062-613-2482', 'ë„ì‹¬ ê³µì—° ê³µê°„',  'geumnam.jpg'),
(5, 'êµ­ë¦½ì•„ì‹œì•„ë¬¸í™”ì „ë‹¹ ì•', 'ê´‘ì£¼ ë™êµ¬', '062-601-4114', 'ê³µì—° í—ˆìš© êµ¬ì—­',  'asia.jpg'),
(5, 'ìƒë¬´ì§€êµ¬ ê±°ë¦¬ê³µì—°ì¡´', 'ê´‘ì£¼ ì„œêµ¬', '062-360-7500', 'ë²„ìŠ¤í‚¹ í™œì„± ì§€ì—­',  'sangmu.jpg'),

-- ìš¸ì‚°
(6, 'íƒœí™”ê°• êµ­ê°€ì •ì›', 'ìš¸ì‚° ì¤‘êµ¬', '052-229-3147', 'ì•¼ì™¸ ê³µì—° ê°€ëŠ¥',  'taehwa.jpg'),
(6, 'ì‚¼ì‚° ë¬¸í™”ê´‘ì¥', 'ìš¸ì‚° ë‚¨êµ¬', '052-226-5373', 'ë„ì‹¬ ê³µì—° ì§€ì—­',  'samsan.png'),
(6, 'ëŒ€ì™•ì•”ê³µì› ë¬´ëŒ€', 'ìš¸ì‚° ë™êµ¬', '052-209-3738', 'ê´€ê´‘ ê³µì—°ì§€',  'daewang.jpg'),

-- ëŒ€ì „
(7, 'ì—‘ìŠ¤í¬ ì‹œë¯¼ê´‘ì¥', 'ëŒ€ì „ ìœ ì„±êµ¬', '042-250-1114', 'ëŒ€í˜• ê´‘ì¥ ê³µì—° ê°€ëŠ¥',  'expo.jpg'),
(7, 'ì€í–‰ë™ ìœ¼ëŠ¥ì •ì´ê±°ë¦¬', 'ëŒ€ì „ ì¤‘êµ¬', '042-252-7100', 'ê±°ë¦¬ ë²„ìŠ¤í‚¹ ëª…ì†Œ',  'jung.jpg'),
(7, 'í•œë¹›íƒ‘ ê´‘ì¥', 'ëŒ€ì „ ìœ ì„±êµ¬', '042-270-8452', 'ì•¼ì™¸ ê³µì—° ë¬´ëŒ€',  'hanstar.jpg');


   -- RESERVATION
   CREATE TABLE place_reservation (
    id BIGINT NOT NULL AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    place_id BIGINT NOT NULL,

    band_name VARCHAR(100) NOT NULL,
    band_count INT NOT NULL,

    phone VARCHAR(50) NULL,
    email VARCHAR(100) NULL,

    reservation_date DATE NOT NULL,
    start_time TIME NOT NULL,
    end_time TIME NULL COMMENT 'ì—†ìœ¼ë©´ start_timeë§Œ ì €ì¥í•´ë„ ë¨',

    status TINYINT NOT NULL DEFAULT 1 COMMENT '1=ì™„ë£Œ,0=ì·¨ì†Œ',
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_res_place
        FOREIGN KEY (place_id) REFERENCES place(place_id),

    -- âœ… ì¤‘ë³µ ë°©ì§€ë¥¼ ìœ„í•œ ìœ ë‹ˆí¬ ì¸ë±ìŠ¤ (status í¬í•¨)
    UNIQUE KEY uq_place_reservation_slot (place_id, reservation_date, start_time, status)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;


-- (ì„ íƒ) ê°™ì€ ì¥ì†Œ/ë‚ ì§œ/ì‹œê°„ ì¤‘ë³µ ë°©ì§€
CREATE UNIQUE INDEX uq_place_reservation_slot
ON place_reservation(place_id, reservation_date, start_time);

SHOW TABLES;

use buskingdb;
select * from place;

drop table member;

drop table gear;
drop table gear_reservation;

drop table city;
drop table place;
drop table place_reservation;

-- ì§€ì—­ë³„ ì¥ì†Œ ì¡°íšŒ
select city_id, place_name from place;

-- ì§€ì—­ ì¡°íšŒ
select * from city;

-- ì¥ì†Œ ì˜ˆì•½ ì¡°íšŒ
select * from place_reservation;

-- ì¥ë¹„ ì¡°íšŒ
select * from gear;

-- ì¥ë¹„ ì˜ˆì•½ ì¡°íšŒ
select * from gear_reservation;

DROP INDEX uq_reservation_slot ON reservation;

show tables;
-- ê¶Œí•œ ë¶€ì—¬ í…Œì´ë¸”
CREATE TABLE role (
  role_id BIGINT NOT NULL AUTO_INCREMENT,
  role_name VARCHAR(30) NOT NULL UNIQUE COMMENT 'USER, ADMIN ë“±',
  PRIMARY KEY (role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

select * from member;
-- ì¼ë°˜ íšŒì› ê¶Œí•œ íšŒì› ë§¤í•‘
CREATE TABLE member_role (
  member_role_id BIGINT NOT NULL AUTO_INCREMENT,
  member_id BIGINT NOT NULL,
  role_id BIGINT NOT NULL,
  PRIMARY KEY (member_role_id),
  CONSTRAINT fk_member_role_member
    FOREIGN KEY (member_id) REFERENCES member(id),
  CONSTRAINT fk_member_role_role
    FOREIGN KEY (role_id) REFERENCES role(role_id),
  UNIQUE KEY uq_member_role (member_id, role_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

INSERT INTO role(role_name) VALUES ('USER'), ('ADMIN');

-- (ì˜ˆì‹œ) ê´€ë¦¬ì íšŒì› ì¶”ê°€ (member ìŠ¤í‚¤ë§ˆ ì»¬ëŸ¼ì— ë§ê²Œ ë„ˆí¬ ì»¬ëŸ¼ìœ¼ë¡œ ì¡°ì •)
INSERT INTO member(member_id, pw, name)
VALUES ('123456', '123456', 'ê´€ë¦¬ì');

-- ë°©ê¸ˆ ë„£ì€ ê´€ë¦¬ì id ì°¾ê¸°
SELECT id FROM member WHERE member_id='123456';

-- ADMIN role_id ì°¾ê¸°
SELECT role_id FROM role WHERE role_name='ADMIN';

-- ê´€ë¦¬ìì—ê²Œ ADMIN ê¶Œí•œ ë¶€ì—¬
INSERT INTO member_role(member_id, role_id)
SELECT m.id, r.role_id
FROM member m, role r
WHERE m.member_id='123456'
  AND r.role_name='ADMIN';

SELECT * FROM role;
SELECT * FROM member_role;


-- board

-- =========================
-- ê²Œì‹œíŒ ì¢…ë¥˜ í…Œì´ë¸”
-- =========================
CREATE TABLE board_type (
    board_type_id INT AUTO_INCREMENT PRIMARY KEY,
    board_name VARCHAR(50) NOT NULL UNIQUE COMMENT 'ê²Œì‹œíŒ ì´ë¦„ (í™ë³´ê²Œì‹œíŒ, Q&A ë“±)'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

select * from board;

-- =========================
-- ê²Œì‹œê¸€ í…Œì´ë¸”
-- =========================
CREATE TABLE board (
    board_id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL COMMENT 'ì‘ì„±ì ì°¸ì¡° (member í…Œì´ë¸” FK ì˜ˆì •)',
    board_type_id INT NOT NULL COMMENT 'ê²Œì‹œíŒ ì¢…ë¥˜ ì°¸ì¡°',
    title VARCHAR(200) NOT NULL COMMENT 'ì œëª©',
    content TEXT NOT NULL COMMENT 'ë‚´ìš©',
    create_writer_at DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT 'ìƒì„±ì¼',
    thumbnail_writer VARCHAR(255) COMMENT 'ê²Œì‹œ ì‚¬ì§„',

    -- ğŸ”¹ FK
    CONSTRAINT fk_board_type
        FOREIGN KEY (board_type_id)
        REFERENCES board_type(board_type_id)
        ON DELETE RESTRICT
        ON UPDATE CASCADE,

    -- ğŸ”¹ ì¡°íšŒ ì„±ëŠ¥ìš© ì¸ë±ìŠ¤
    INDEX idx_board_type (board_type_id),
    INDEX idx_user (user_id),
    INDEX idx_created (create_writer_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- =========================
-- ê²Œì‹œíŒ ì¢…ë¥˜ ìƒ˜í”Œ ë°ì´í„°
-- =========================
INSERT INTO board_type (board_name) VALUES
('í™ë³´ê²Œì‹œíŒ'),
('Q&A');

-- =========================
-- ê²Œì‹œê¸€ ìƒ˜í”Œ ë°ì´í„°
-- =========================
INSERT INTO board (
    user_id,
    board_type_id,
    title,
    content,
    thumbnail_writer
) VALUES
(1, 1, 'ì²« í™ë³´ê²Œì‹œíŒ ê¸€', 'í™ë³´ ë‚´ìš©ì…ë‹ˆë‹¤', NULL),
(1, 2, 'ì²« Q&A ê¸€', 'ì§ˆë¬¸ ë‚´ìš©ì…ë‹ˆë‹¤', NULL);

-- =========================
-- ê²Œì‹œíŒë³„ ì¡°íšŒ ì˜ˆì‹œ
-- =========================
-- í™ë³´ê²Œì‹œíŒ ê¸€
SELECT * FROM board
WHERE board_type_id = 1
ORDER BY board_id DESC;

-- Q&A ê¸€
SELECT * FROM board
WHERE board_type_id = 2
ORDER BY board_id DESC;

-- ì¡°ì¸í•´ì„œ ê²Œì‹œíŒ ì´ë¦„ í¬í•¨ ì¡°íšŒ
SELECT
    b.board_id,
    b.title,
    b.create_writer_at,
    bt.board_name
FROM board b
JOIN board_type bt
  ON b.board_type_id = bt.board_type_id
ORDER BY b.board_id DESC;